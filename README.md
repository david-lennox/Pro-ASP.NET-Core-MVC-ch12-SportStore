# Pro-ASP.NET-Core-MVC-ch12-SportStore
This is the most complete application presented in Pro ASP.NET Core MVC, which is a very comprehensive text.

## Defining and Generating Databases

The databases are defined and generated by the DbContext classes. The first two of the following steps may have already been completed. If so there will be migration files for the respective databases.

Run:

  * Enable-Migrations -Context ApplicationDbContext
  * Add-Migration Initial -Context ApplicationDbContext 
  * Update-Database -Context ApplicationDbContext

Do the same for the AppIdentityDbContext.

Note that you can omit the -Context command if there is only one DbContext. If more than one, you need to tell Entity Framework which one to use, and it will automatically create a folder for the DbContext within the Migrations folder to keep them separate.



# Core Concepts

## Startup.cs with built in Dependency Injection

In earlier versions of ASP.NET, the System.Web assembly took care of starting the app, and the global.asax file had methods (Application_Start / Application_End etc.) that were called by System.Web in which you could provide custom logic. The steps needed to start up an application are now determined by you using the Program.cs and the Startup class. The `Program.Main()` method is the entry point for the application, but it is unlikely you need to make changes to this from the defaul boilerplate. The `Main()` starts up the web server and uses the Startup class to configure it.


## Middleware

[Very good article explaining middleware](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware) summarised here:

  - All http requests are handled by middleware.
  - All http responses are created by middleware.
  - Middleware exist in a pipeline, each middleware 'component' responsible for calling the next or short-circuiting the pipeline if necessary.
  - Middleware components can perform logic before and after they pass control onto the next component.
  - The simplest possible web application is one with a single Middlware written as an anonymous lambda function inside `Startup.Configure()` that responds to any request with a "Hello, World!".
  - See Chapter 14 of Pro ASP.NET Core MVC - Configuring Applications.

  ## Incorporating React (or some other SPA)

  A Single Page Application (SPA) can be served up as a static file. To do this:

  1. Program.Main() should include: `UseContentRoot(Directory.GetCurrentDirectory())`
  2. Startup.Configure() should include: `app.UseStaticFiles();`
  3. Also need dependency on: "Microsoft.AspNetCore.StaticFiles".

With these in place the server will serve up anything under wwwroot. Therefore, we simply put the entire SPA under wwwroot. But beware! The MVC router will take control by default. Even if the `app.UseStaticFiles();` comes before `app.UseMvc()` so any route that matches an MVC route will be handled by the MVC framework. 

So **matching the application's base URL** to wwwroot/index.html is a bit tricky. The solution to this problem is provided [here](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/static-files). In order for your Web app to serve a default page without the user having to fully qualify the URI, call the UseDefaultFiles extension method from Startup.Configure as follows.